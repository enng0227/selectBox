(function(e){"use strict";var t={},i=function(){},l=["margin","padding"],n=["Left","Right","Top","Bottom"],s=["float","display","margin","width"],a=["create","change","formatter","filterItem","filter","filtered","input"],r=1,o='<div class="select-box"><div class="select-box-inner"><div class="v-align"><input type="text" class="select-text" /></div></div><dl></dl></div>',c={dataKey:[],style:{},keys:{text:"text",value:"id"},placeholder:null,options:null,combo:false,clearText:false,hideArrowOnDisabled:false,toggleArrow:false,disabled:false,noBorder:false,maxHeight:null,copyStyle:true,input:null,filter:null,filtered:null,filterItem:null,formatter:null,create:null,change:null},d={init:function(e,t){this.validProp(e);this.create(e,t);this.bindEvent(e);return this.getMethods(e)},validProp:function(t){e.each(a,function(i,l){if(!e.isFunction(t.config[l])){t.config[l]=null}})},change:function(e,t,i){var l=e.config,n=l.keys;if(t&&i){if(e.originSelectSource){var s=l.node,a=s.find('option[value="'+t[n.value]+'"]'),r=s.find('option[value="'+i[n.value]+'"]');if(a.length){a.attr("selected","selected").prop("selected",true)}if(r.length){r.removeAttr("selected").prop("selected",false)}s.trigger("change")}if(l.combo&&l.input){l.input.call(e,this.getSelected(e))}if(l.change){l.change.call(e,t)}}return true},getSelected:function(e){var t=e.config,i=t.options||[],l=t.keys,n=e.text&&e.text.val(),s=e.selected?e.selected.data("select-index"):0,a=i[s];if(t.combo){if(a&&a[l.text]===n){a.custom=false;return a}else{var r={};r[l.text]=n;r[l.value]="";r.selected=true;r.custom=true;return r}}else{return a}},select:function(e,t,i){if(e&&t){var l=t.data("group-index"),n=t.data("select-index"),s=e[l];t.toggleClass("on",i);if(s&&s.options){var a=s.options[n];if(a){a.selected=i}return a}}return null},setSelected:function(e,t){if(!t.jquery){t=e.wrap.find('dd[data-id="'+t+'"]')}if(t.length&&!t.hasClass("on")){var i=this,l=e.config,n=l.isGroup?l.options:[{options:l.options}],s=t.text(),a=i.select(n,e.selected,false),r=i.select(n,t,true);if(r){e.selected=t}if(l.formatter){s=l.formatter(s)}e.text.val(s).attr("value",s);return i.change(e,r,a)}return false},unbindEvent:function(e){var t=e.wrap,i=e.config;if(t){t.toggleClass("hide-arrow",!!i.hideArrowOnDisabled);t.addClass("disabled");t.removeClass("open");t.off("click");if(i.combo&&i.input){t.off("input propertychange")}}},bindEvent:function(i){var l=this,n=i.wrap,s=i.config;l.unbindEvent(i);if(n&&!s.disabled){n.toggleClass("hide-arrow",!!s.hideArrowOnDisabled);n.removeClass("disabled");if(s.combo&&s.input){n.on("input propertychange",".select-text",function(){s.input.call(i,l.getSelected(i))})}n.on("click",".select-box-inner",function(a){if(n.hasClass("open")){n.removeClass("open")}else{if(t.wrap){t.wrap.removeClass("open")}t.wrap=i.wrap;if(s.filterItem){l._setOptions(i)}n.addClass("open");if(s.combo&&s.clearText){var r=e(a.target);if(r.is(".select-text")){r.val("");n.removeClass("open")}}}});n.on("click","dd",function(){l.setSelected(i,e(this));n.removeClass("open")});l._preventScroll(i.listWrap);if(!t.doc){t.doc=e(document).on("click",function(i){var l=e(i.target);if(!l.is(".select-box")&&!l.closest(".select-box").length&&t.wrap){t.wrap.removeClass("open")}})}}if(s.create){s.create.call(i,this.getSelected(i))}},getBoxId:function(e){var t=e.data("select-box-id");if(e&&!t){t="select_"+r++;e.attr("data-select-box-id",t)}return t},create:function(t,i){var l=this,n=t.config,s=n.node,a=n.options=n.options||[];var r=l._parseOptions(t,n,a,i);if(r&&e.type(n.disabled)==="undefined"){n.disabled=s.prop("disabled")||s.attr("disabled")||s.attr("readonly")}t.wrap=l.createWrap(s,t.originSelectSource,n);t.listWrap=t.wrap.find("dl");t.wrap.css(n.style);if(n.maxHeight){t.listWrap.css({maxHeight:n.maxHeight})}t.listWrap.toggleClass("group",n.isGroup);t.text=t.wrap.find(".select-text").attr("readonly",!n.combo);if(n.noBorder){t.wrap.find(".select-box-inner").css({borderColor:"transparent"})}l._setOptions(t,true)},fetch:function(e,t,i){if(e&&e.length&&i){for(var l=0;l<e.length;l++){var n=e[l];if(n&&!t[n]){i(n)}}}},createWrap:function(t,i,a){var r=t;if(i){if(a.copyStyle){var c={},d=e.isArray(a.copyStyle)?a.copyStyle:s;e.each(d,function(i,s){var a=t.css(s);if(a){c[s]=a}else if(e.inArray(s,l)>-1){e.each(n,function(e,i){c[s+i]=t.css(s+i)})}});a.style=e.extend(true,{},c,a.style)}r=t.prev("div.select-box");if(!r.length){r=e(o);t.hide().before(r)}}else{t.addClass("select-box");if(!t.find(".select-box-inner").length||!t.find("dl").length){t.html('<div class="select-box-inner"><div class="v-align"><input type="text" class="select-text" /></div></div><dl></dl>')}}return r.toggleClass("combo",!!a.combo).toggleClass("toggle",!!a.toggleArrow)},_parseOptions:function(e,t,i,l){var n=this,s=t.node,a=t.keys,r=false,o=false,c=false;if(!l){e.originStyle=s.attr("style");e.originClass=s.attr("class");e.sourceHTML=s.html()}if(i.length){r=!!i[0].label&&!i[0][a.text]&&!i[0][a.value]}else{if(s.is("select")){s.css("visibility","hidden");var d=s.find("optgroup");r=!!d.length;if(!r){d=d.add(s)}d.each(function(e){var l=d.eq(e),o=r?[]:i,c=l.find("option");c.each(function(e){var i={},l=c.eq(e);i[a.text]=l.text();i[a.value]=l.attr("value")||"";i.selected=l.prop("selected");n.fetch(t.dataKey,a,function(e){i[e]=l.data(e)||s.data(e)});o.push(i)});if(r){i.push({label:l.attr("label"),options:o})}});c=true}else{var f=s.find("dl");r=f.length>1;if(f.length){f.each(function(e){var l=f.eq(e),o=r?[]:i,c=l.find("dd");c.each(function(e){var i={},l=c.eq(e);i[a.text]=l.text();i[a.value]=l.data(a.value)||"";i.selected=!!l.data("selected");n.fetch(t.dataKey,a,function(e){i[e]=l.data(e)||s.data(e)});o.push(i)});if(r){i.push({label:l.data("label"),options:o})}});o=true}}}e.originSelectSource=c;e.ddSource=o;t.isGroup=r;return c||o},_setPlaceholder:function(e,t,i){if(e.placeholder){var l=e.keys,n={};if(t[0].placeholder){t.shift()}if(!i&&t.length&&t[0][l.text]!==e.placeholder){n[l.text]=e.placeholder;n[l.value]="";n.selected=false;n.placeholder=true;t.splice(0,0,n)}}},_showSelected:function(e){var t=e.config,i=e.wrap.find("dd.on");if(!i.length){i=e.wrap.find("dd:eq(0)").addClass("on")}var l=i.text();if(t.formatter){l=t.formatter(l)}e.selected=i;e.text.val(l).attr("value",l)},_setOptions:function(e,t,i){var l=e.config,n=l.options,s=false,a=l.keys;if(t&&l.filter){n=l.options=l.filter(n)}this._setPlaceholder(l,n,i);for(var r=0;r<n.length;r++){if(n[r].selected){s=true;break}}if(!s&&n[0]){n[0].selected=true}var o=this._getOptionsHtml(l.isGroup,n,a,l.filterItem);e.listWrap.html(o);this._showSelected(e);if(l.filtered){l.filtered.call(e,n)}if(e.wrap.css("visibility")!=="visible"){e.wrap.css("visibility","visible")}},_getOptionHtml:function(e,t,i,l){return'<dd data-group-index="'+(l||0)+'" data-select-index="'+i+'" data-id="'+e[t.value]+'"'+(e.selected?' class="on"':"")+">"+e[t.text]+"</dd>"},_getOptionsHtml:function(e,t,i,l){var n=[];if(t&&t.length){var s=[{options:t}];if(e){s=t}for(var a=0;a<s.length;a++){var r=s[a];if(e){n.push("<dt>"+(r.label||a+1)+"</dt>")}var o=r.options;if(l){for(var c=0;c<o.length;c++){var d=o[c];d.is_valid=l(d);if(d.is_valid){n.push(this._getOptionHtml(d,i,c,a))}}}else{for(var f=0;f<o.length;f++){n.push(this._getOptionHtml(o[f],i,f,a))}}}}return n.join("")},_preventScroll:function(t){var i=t.jquery?t:e(t);t=i.get(0);if(!i.data("mouse-wheel")){i.attr("data-mouse-wheel",1);if(navigator.userAgent.indexOf("Firefox")>=0){t.addEventListener("DOMMouseScroll",function(e){t.scrollTop+=e.detail>0?60:-60;e.preventDefault()},false)}else{t.onmousewheel=function(e){e=e||window.event;t.scrollTop+=e.wheelDelta>0?-60:60;return false}}}},setOptions:function(e,t,i,l){var n=e.config;e.originSelectSource=false;if(t){delete n.options;n.options=t}delete e.selected;this._setOptions(e,i,l)},getMethods:function(i){var l=this,n=i.config,s={};s.setConfig=function(t){e.extend(true,i.config,t);s.refresh()};s.val=function(e){if(e){return l.setSelected(i,e)}else{return l.getSelected(i)}};s.setOptions=function(e,t,n){l.setOptions(i,e,t,n)};s.refresh=function(){var e=n.options;for(var t=0;t<e.length;t++){if(e[t].selected){e[t].selected=false}}delete i.selected;if(i.originSelectSource){delete n.options}l.init(i,true)};s.disable=function(){if(!n.disabled){n.disabled=true;l.unbindEvent(i);if(n.combo){i.text.attr("readonly","readonly")}}};s.enable=function(){if(n.disabled){n.disabled=false;l.bindEvent(i);if(n.combo){i.text.removeAttr("readonly")}}};s.destroy=function(){l.unbindEvent(i);var e=i.config,n=e.node,s=l.getBoxId(n);if(i.originSelectSource){i.wrap.next().css("visibility","visible").show();i.wrap.remove()}else{i.wrap.html(i.sourceHTML)}n.attr({"data-select-box-id":null,style:i.originStyle||null,"class":i.originClass||null});delete t[s]};return s}};var f=function(t,i){this.config=e.extend(true,{node:e(t)},c,i);return d.init(this)};e.fn.extend({selectBox:function(e){var i=this.first(),l=d.getBoxId(i);if(t[l]){t[l].setConfig(e)}else{t[l]=new f(i,e)}return t[l]},selectBoxs:function(){var t=Array.prototype.slice.apply(arguments),l=t.shift();if(e.type(l)==="string"){var n=e.type(t[t.length-1])==="function"?t.pop():i;return this.each(function(){var i=e(this).selectBox();if(i&&i[l]){n.call(i,i[l].apply(this,t))}})}return this.each(function(){e(this).selectBox(e.extend(true,{},l))})}})})(jQuery);