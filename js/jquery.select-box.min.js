!function(e){"use strict";var t={},n=1,l='<div class="select-box"><div class="select-box-inner"><input type="text" class="select-text"></div><dl></dl></div>',o={dataKey:[],style:{},keys:{text:"text",value:"id"},placeholder:null,options:null,combo:!1,clearTextOnFocus:!1,hideArrowDisabled:!1,onInput:null,filter:null,filtered:null,filterItem:null,formatter:null,create:null,change:null,disabled:!1,noBorder:!1,maxHeight:null,autoCopyStyle:!0},i={init:function(e){var t=this,n=e.config,l=n.create;return t.create(e),t.unbindEvent(e),n.disabled||t.bindEvent(e),l&&"function"==typeof l&&l.call(e,t.getSelected(e)),t.getMethods(e)},change:function(e,t,n){var l=e.config,o=l.keys;if(e.originSelectSource){var i=l.node,s=i.find('option[value="'+t[o.value]+'"]'),a=i.find('option[value="'+n[o.value]+'"]');s.length&&s.attr("selected","selected").prop("selected",!0),a.length&&a.removeAttr("selected").prop("selected",!1),i.trigger("change")}l.combo&&l.onInput&&l.onInput.call(e,this.getSelected(e)),"function"==typeof l.change&&l.change.call(e,t)},getSelected:function(e){var t=e.config,n=t.options||[],l=t.keys,o=e.text&&e.text.val(),i=e.selected?e.selected.data("select-index"):0,s=n[i];if(t.combo){if(s&&s[l.text]===o)return s.custom=!1,s;var a={};return a[l.text]=o,a[l.value]="",a.selected=!0,a.custom=!0,a}return s},setSelected:function(e,t){if(t.jquery||(t=e.wrap.find('dd[data-id="'+t+'"]')),!t.length)return!1;var n=this,l=e.config,o=l.options,i=t.text(),s=t.data("select-index"),a=o[s],r=null;return t.addClass("on"),e.selected&&(e.selected.removeClass("on"),r=o[e.selected.data("select-index")],r&&(r.selected=!1)),a.selected=!0,e.selected=t,l.formatter&&(i=l.formatter(i)),e.text.val(i).attr("value",i).show(),n.change(e,a,r),!0},unbindEvent:function(e){var t=e.wrap,n=e.config;t&&(n.hideArrowDisabled&&t.addClass("hide-arrow"),t.addClass("disabled"),t.off("click"))},bindEvent:function(n){var l=this,o=n.wrap,i=n.config;o&&(o.removeClass("disabled"),i.hideArrowDisabled&&o.removeClass("hide-arrow"),i.combo&&i.onInput&&o.on("input propertychange",".select-text",function(){i.onInput.call(n,l.getSelected(n))}),o.on("click",".select-box-inner",function(s){if(o.hasClass("open"))o.removeClass("open");else if(t.wrap&&t.wrap.removeClass("open"),t.wrap=n.wrap,i.filterItem&&l._setOptions(n),o.addClass("open"),i.combo&&i.clearTextOnFocus){var a=e(s.target);a.is(".select-text")&&(a.val(""),o.removeClass("open"))}}),o.on("click","dd",function(){var t=e(this);t.hasClass("on")||l.setSelected(n,t),o.removeClass("open")}),l._preventScroll(n.listWrap),t.selectEventProxy||(t.selectEventProxy=!0,e(document).on("click",function(t){var n=e(t.target);n.is(".select-box")||n.closest(".select-box").length||e(".select-box").removeClass("open")})))},getBoxId:function(e){var t=e.data("select-box-id");return e&&!t?(t="select_"+n++,e.attr("data-select-box-id",t),t):t},create:function(e){var t=this,n=e.config,l=n.node,o=n.options=n.options||[],i=t._parseOptions(e,n,o);e.wrap=t.createWrap(l,i||!l.is("div"),n),e.listWrap=e.wrap.find("dl"),e.wrap.css(n.style),n.maxHeight&&e.listWrap.css({maxHeight:n.maxHeight}),e.text=e.wrap.find(".select-text"),e.text.attr("readonly",!n.combo),n.noBorder&&e.wrap.find(".select-box-inner").css({borderColor:"transparent"}),t._setOptions(e,!0)},fetch:function(e,t,n){if(e&&e.length&&n)for(var l=0;l<e.length;l++){var o=e[l];o&&!t[o]&&n(o)}},createWrap:function(t,n,o){var i=t;if(n){if(i=t.prev("div.select-box"),!i.length){if(o.autoCopyStyle){var s={width:t.css("width"),margin:t.css("margin"),"float":t.css("float")};o.style=e.extend(!0,{},s,o.style)}i=e(l),t.before(i),t.hide(),o.disabled=t.prop("disabled")||t.attr("readonly")}}else t.hasClass("select-box")||t.addClass("select-box"),t.find(".select-box-inner").length&&t.find("dl").length||t.html('<div class="select-box-inner"><input type="text" class="select-text"></div><dl></dl>');return o.combo&&i.addClass("combo"),i},_parseOptions:function(e,t,n){var l=this,o=t.node,i=t.keys,s=!1,a=!1,r=!1;if(!n.length)if(o.is("select")){o.css("visibility","hidden");var c=o.find("option");c.each(function(e){var s={},a=c.eq(e);s[i.text]=a.text(),s[i.value]=a.attr("value")||"",s.selected=a.prop("selected"),l.fetch(t.dataKey,i,function(e){s[e]=a.data(e)||o.data(e)}),n.push(s)}),r=!0,s=!0}else{var d=o.find("dl>dd");d.length&&(d.each(function(e){var s={},a=d.eq(e);s[i.text]=a.text(),s[i.value]=a.data(i.value)||"",s.selected=!!a.data("selected"),l.fetch(t.dataKey,i,function(e){s[e]=a.data(e)||o.data(e)}),n.push(s)}),a=!0)}return e.originSelectSource=r,e.domSource=a||r,s},_setPlaceholder:function(e,t,n){if(e.placeholder){var l=e.keys,o={};t[0].placeholder&&t.shift(),!n&&t.length&&t[0][l.text]!==e.placeholder&&(o[l.text]=e.placeholder,o[l.value]="",o.selected=!1,o.placeholder=!0,t.splice(0,0,o))}},_showSelected:function(e){var t=e.config,n=e.wrap.find("dd.on");n.length||(n=e.wrap.find("dd:eq(0)").addClass("on"));var l=n.text();t.formatter&&(l=t.formatter(l)),e.selected=n,e.text.val(l).attr("value",l).show()},_setOptions:function(e,t,n){var l=e.config,o=l.options,i=!1,s=l.keys;t&&l.filter&&"function"==typeof l.filter&&(o=l.options=l.filter(o)),this._setPlaceholder(l,o,n);for(var a=0;a<o.length;a++)if(o[a].selected){i=!0;break}!i&&o[0]&&(o[0].selected=!0);var r=this._getOptionsHtml(o,s,l.filterItem);e.listWrap.html(r),this._showSelected(e),l.filtered&&l.filtered.call(e,o)},_getOptionHtml:function(e,t,n){return'<dd data-select-index="'+n+'" data-id="'+e[t.value]+'"'+(e.selected?' class="on"':"")+">"+e[t.text]+"</dd>"},_getOptionsHtml:function(e,t,n){var l=[];if(e&&e.length)if(n)for(var o=0;o<e.length;o++){var i=e[o];i.is_valid=n(i),i.is_valid&&l.push(this._getOptionHtml(i,t,o))}else for(var s=0;s<e.length;s++)l.push(this._getOptionHtml(e[s],t,s));return l.join("")},_preventScroll:function(e){e.jquery&&(e=e.get(0)),e.getAttribute("data-mouse-wheel")||(e.setAttribute("data-mouse-wheel","bind"),navigator.userAgent.indexOf("Firefox")>=0?e.addEventListener("DOMMouseScroll",function(t){e.scrollTop+=t.detail>0?60:-60,t.preventDefault()},!1):e.onmousewheel=function(t){return t=t||window.event,e.scrollTop+=t.wheelDelta>0?-60:60,!1})},setOptions:function(e,t,n,l){var o=e.config;e.originSelectSource=!1,t&&(delete o.options,o.options=t),delete e.selected,this._setOptions(e,n,l)},getMethods:function(n){var l=this,o=n.config,i={};return i.setConfig=function(t){e.extend(!0,n.config,t),i.refresh()},i.val=function(e){return e?l.setSelected(n,e):l.getSelected(n)},i.setOptions=function(e,t,o){l.setOptions(n,e,t,o)},i.refresh=function(){for(var e=o.options,t=0;t<e.length;t++)e[t].selected&&(e[t].selected=!1);delete n.selected,n.originSelectSource&&delete o.options,l.init(n)},i.disable=function(){o.disabled||(o.disabled=!0,l.unbindEvent(n),o.combo&&n.text.attr("readonly","readonly"))},i.enable=function(){o.disabled&&(o.disabled=!1,l.bindEvent(n),o.hideArrowDisabled&&n.wrap.removeClass("hide-arrow"),o.combo&&n.text.removeAttr("readonly"))},i.destroy=function(){l.unbindEvent(n);var e=l.getBoxId(n.config.node);n.originSelectSource&&(n.wrap.next().css("visibility","visible").show(),n.wrap.remove()),delete t[e]},i}},s=function(t,n){return this.config=e.extend(!0,{node:e(t)},o,n),i.init(this)};e.fn.extend({selectBox:function(e){var n=this.eq(0),l=i.getBoxId(n);return t[l]?t[l].setConfig(e):t[l]=new s(n,e),t[l]},selectBoxs:function(){var t=Array.prototype.slice.apply(arguments),n=t.shift();if("string"===e.type(n)){var l="function"===e.type(t[t.length-1])?t.pop():function(){};return this.each(function(){var o=e(this).selectBox();o&&o[n]&&l.call(o,o[n].apply(this,t))})}return this.each(function(){e(this).selectBox(e.extend(!0,{},n))})}})}(jQuery);